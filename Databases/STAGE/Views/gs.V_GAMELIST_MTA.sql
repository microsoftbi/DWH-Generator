SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO



CREATE VIEW [gs].[V_GAMELIST_MTA]
AS
	SELECT LOAD_DTS,
		TODATETIMEOFFSET(
			CAST(CAST(CAST([FILE_TRANSFER_DTS] AS DATE) AS VARCHAR(10)) + ' '
				+ CAST(CAST('00:00:00' AS TIME) AS VARCHAR(16)) AS DATETIME2(7)),
			DATEDIFF(MINUTE, GETUTCDATE(), GETDATE())
		) AS LOAD_DTS_BATCH,
		ROW_NUMBER() OVER (ORDER BY CONVERT(NVARCHAR(30), [ID])) AS [SEQUENCE_NO],
		CAST(NULL AS NCHAR(1)) AS CDC_OPERATION_CODE,
		'[gs]' AS [REC_SRC],
		[FULLY_QUALIFIED_FILE_NAME],
		CAST(NULL AS DATETIMEOFFSET(7)) AS [INSERT_DTS],
		CAST(NULL AS DATETIMEOFFSET(7)) AS [UPDATE_DTS],
		CAST(NULL AS DATETIMEOFFSET(7)) AS [EXPORT_DTS],
		[FILE_TRANSFER_DTS],
		SYSDATETIMEOFFSET() AS [SESSION_DTS],
		CAST(NULL AS DATETIMEOFFSET(7)) AS [SOURCE_SLICE_DTS],
		CAST('FULL' AS NVARCHAR(10)) AS [LOAD_TYPE],
		CONVERT(CHAR(32), HASHBYTES('MD5', ISNULL(TRIM(CONVERT(NVARCHAR(50), [ID])+N'@|@'), N'')), 2) AS HK,
		CONVERT(
			CHAR(32),
			HASHBYTES(
				'MD5',
				+ ISNULL(TRIM(CONVERT(NVARCHAR(255), [Game name])), N'') + N'@|@'
				+ ISNULL(TRIM(CONVERT(NVARCHAR(255), [AREA])), N'') + N'@|@'
				+ ISNULL(TRIM(CONVERT(NVARCHAR(255), [PRICE])), N'') + N'@|@'
				+ ISNULL(TRIM(CONVERT(NVARCHAR(255), [Operator])), N'') + N'@|@'
				),
			2
			) AS HD,
		CONVERT(
			CHAR(32),
			HASHBYTES(
				'MD5',
				+ ISNULL(TRIM(CONVERT(NVARCHAR(255), [ID])), N'') + N'@|@'
				+ ISNULL(TRIM(CONVERT(NVARCHAR(255), [Game name])), N'') + N'@|@'
				+ ISNULL(TRIM(CONVERT(NVARCHAR(255), [AREA])), N'') + N'@|@'
				+ ISNULL(TRIM(CONVERT(NVARCHAR(255), [PRICE])), N'') + N'@|@'
				+ ISNULL(TRIM(CONVERT(NVARCHAR(255), [Operator])), N'') + N'@|@'
				),
			2
			) AS HF,
		[ID],
		[Game name],
		[AREA],
		[PRICE],
		[Operator]
	FROM [gs].[GAMELIST];
GO
